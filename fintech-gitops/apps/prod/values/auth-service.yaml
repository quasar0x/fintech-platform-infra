nameOverride: auth-service

replicaCount: 1

image:
  repository: 461508717137.dkr.ecr.us-east-1.amazonaws.com/auth-service
  tag: sha-2eba036
  pullPolicy: IfNotPresent

service:
  port: 80
  targetPort: 8081

containerPort: 8081

env:
  APP_NAME: "auth-service"
  ENVIRONMENT: "prod"
  PORT: "8081"
  JWT_ISSUER: "fintech-auth"
  JWT_AUDIENCE: "fintech-platform"
  ACCESS_TOKEN_TTL_SECONDS: "900"
  REFRESH_TOKEN_TTL_SECONDS: "604800"

  # --- DB connection (use terraform outputs) ---
  DB_HOST: "fintech-platform-auth-db.caley62smz6e.us-east-1.rds.amazonaws.com"
  DB_PORT: "5432"
  DB_NAME: "auth"
  DB_USER: "authadmin"
  DB_SSLMODE: "require"

  # ✅ read private key from mounted file
  JWT_PRIVATE_KEY_PATH: "/var/run/secrets/jwt/jwt_private.pem"

  # ✅ public key can be plain env (not secret)
  JWT_PUBLIC_KEY: |-
    -----BEGIN PUBLIC KEY-----
    MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAquF0JfwrX/v3OxVdDdjd
    tQHVAfyuZRgmwXYli2LqbCSN1WA9ESO4os2FOfSmNCsxhM/xoYycQsiwwgi3B/Z5
    TeWSs14XHVAd36ldxKbiTfAV9/flRPCAGUVVekWG4SK7gwu2Vj1sd1HEVktNDPqs
    M21hPsndh1n0MOgl/CGDMZaQC7wbVJnouG/gvAgOjjKXJCl2ITl0qTYc/Gabz/8F
    47TSGcXrVtKRz47ty+67cMf4ZxoOYJvw1i2OlPuO5/JA/hz/pCK02gneJbQihw3Z
    vWPx4EBCK7KL1M/YRSjD6XRmnmMpfvZBHNTBDJF3oUjhIohxH8P2fAsnzXhVJya3
    9wIDAQAB
    -----END PUBLIC KEY-----

secrets:
  enabled: true
  existingSecretName: auth-service-secret
  keys:
    - DB_PASSWORD
    - JWT_PRIVATE_KEY

  mounts:
    - name: auth-jwt-key
      mountPath: /var/run/secrets/jwt
      readOnly: true

  volumes:
    - name: auth-jwt-key
      secret:
        secretName: auth-service-secret
        items:
          - key: JWT_PRIVATE_KEY
            path: jwt_private.pem

readinessProbe:
  enabled: true
  path: /readyz
  initialDelaySeconds: 5
  periodSeconds: 10

livenessProbe:
  enabled: true
  path: /healthz
  initialDelaySeconds: 10
  periodSeconds: 10
